# Alpha review checklist — architecture, correctness, efficiency, client-ready

OBLIGATORY: Use only the project's scripts for build, clean, setup, compile_shaders (e.g. scripts/linux/build.sh, scripts/linux/clean.sh, scripts/windows/build.bat, setup.sh, etc.). Improve scripts if needed, but do not replace them with ad-hoc commands.

Goal: Review + improve. Fix issues and apply improvements while checking. Project must be scalable.
When in doubt on a decision, ask the user.

================================================================================
1. ARCHITECTURE — COHERENCE & USAGE
================================================================================

- [x] Scene model: Single unified Scene only. Migrated app to SceneUnified; removed scene.h and SceneNew from build; core.h includes scene/scene_unified.h.
- [x] core.h: umbrella used from main.cpp (include "core/core.h").
- [x] managers.h: umbrella used from main.cpp; managers.h includes all manager headers.
- [x] Frame flow matches docs: Input → Scene update (transforms, lights) → Build render list → Record commands → Submit. Verified in vulkan_app Run loop.
- [x] Extension points: ResourceCleanupManager has all five managers (Material, Mesh, Texture, Pipeline, Shader); VulkanApp sets them. Init order in InitVulkan.
- [x] docs/engine-design.md bugs: Confirmed fixed (normals, emissive, matProps in shaders); improve if needed.

================================================================================
2. IS EVERYTHING USED?
================================================================================

- [x] SceneUnified: app uses it as the single scene; scene.h and SceneNew removed from build; RenderListBuilder removed (BatchedDrawList only).
- [x] core.h, managers.h: wired as umbrella from main.cpp; managers.h includes all manager headers.
- [x] physics_component.h: stub; any code path that creates/reads PhysicsComponent? If unused, document “not in alpha”.
- [x] script_component.h: stub; no execution path. Documented "Not in alpha" in header.
- [x] camera_component: used by ViewportManager, EditorLayer (DrawCamerasPanel), unified Scene.
- [x] GPUCuller: always on (mandatory); default true in config.
- [x] RingBuffer: used for ObjectData SSBO; GetFrameData(lFrameIndex); ring matches framesInFlight.
- [x] Object SSBO offset: m_currentFrameObjectDataOffset set and used in dynamicOffsets each frame.
- [x] BatchedDrawList: sole draw-list path; RenderListBuilder removed from build (unused).
- [x] TieredInstanceManager: integrated; UpdateSSBO called each frame with render list and batches.
- [x] LevelSelector: EditorLayer, MainMenu, RuntimeOverlay. StressTestGenerator: editor + runtime stress-test menu.

================================================================================
3. EFFICIENCY — HOT PATHS & RESOURCES
================================================================================

- [ ] Per-frame allocations: any vector::push_back/resize in render or sync path that could reserve() once? (e.g. draw call lists, visible lists)
- [ ] Descriptor sets: reuse across frames? Pool sizing (max sets) sufficient; no per-frame alloc in hot path.
- [ ] Pipeline barriers: only where needed (image layout, buffer visibility). No redundant vkCmdPipelineBarrier.
- [ ] Buffer updates: object/light SSBOs use ring buffer per frame; no map/unmap per draw. Confirm single write per frame per buffer.
- [ ] Draw call batching: sort by pipeline then mesh; minimal state changes. Verify order in VulkanApp/BatchedDrawList.
- [ ] Frustum culling: done once per view; results reused for all passes. No duplicate cull per draw.
- [ ] Manager caches: TrimUnused on worker thread; main thread never blocks on trim. Confirm.
- [ ] Job queue: loading on worker; completion callback on main. No busy-wait.
- [ ] shared_ptr use: refs held only where needed; TrimUnused can drop unused. No unnecessary shared_ptr in hot path (e.g. per-draw).
- [ ] Mesh/material lookups: by handle or index; no per-frame map lookups in inner loop if avoidable.

================================================================================
4. VULKAN CORRECTNESS — SYNC & LIFETIME
================================================================================

- [x] vkWaitForFences: before reusing command buffer / frame resources (vulkan_app submit flow). Fence signaled in same submit as usage.
- [x] Semaphore chain: imageAvailable → command buffer → renderFinished → present (vulkan_app.cpp submit; wait stage COLOR_ATTACHMENT_OUTPUT).
- [ ] Pipeline barriers (render pass): layout transitions and access masks match actual usage (e.g. COLOR_ATTACHMENT_WRITE → SHADER_READ for resolve/read).
- [ ] Pipeline barriers (texture upload): TRANSFER_WRITE → SHADER_READ; stages TOP_OF_PIPE → TRANSFER, TRANSFER → FRAGMENT.
- [ ] Pipeline barriers (compute): GPUCuller host write → compute read; compute write → indirect/vertex read. Stages and access flags correct.
- [ ] Descriptor set writes: before vkCmdBindDescriptorSets; no use of set that was updated later in same frame without sync.
- [ ] Buffer/image lifetime: no destroy or resize while in use by GPU. Deferred destroy after fence wait.
- [ ] Swapchain: acquire → use imageIndex for framebuffer → submit with imageAvailable semaphore → present with renderFinished. No reuse of image before present.
- [ ] Validation layers: run with Debug build; zero errors/warnings. Fix or document known acceptable warnings.

================================================================================
5. SHADER & DATA LAYOUT CORRECTNESS
================================================================================

- [ ] Push constant layout: CPU and GLSL match (size, offsets). object.h kInstancedPushConstantSize == 96; vert.vert layout verified.
- [ ] SSBO/UBO strides and offsets: ObjectData 256B, alignment; light buffer element size; descriptor offset/range correct.
- [ ] Vertex attribute layout: position, UV, normal, etc. Match in pipeline and mesh data.
- [ ] Normal transform: if using model matrix for normals, use transpose(inverse(model)) and pass to shader; engine-design.md listed “no model matrix for normals” as bug — fix or doc.
- [ ] Emissive: Object.emissive populated; frag.frag uses it. If not, fix or doc as alpha limitation.
- [ ] Binding numbers: descriptor set 0 bindings 0–8 (or used subset) consistent across all pipelines that use them.

================================================================================
6. CODE CORRECTNESS & LOGIC
================================================================================

- [x] object.h: still used for level parsing (vector<Object>) and stress test; instanced path uses RenderObject from BuildRenderList. No removal needed; Object is input type only.
- [x] vulkan_app: binding 8 wired to GPU culler; always on per user.
- [x] scene_unified.cpp: hierarchy/world matrix implemented (UpdateTransformHierarchy); bounds center from world matrix, radius from scale fallback (TODO: actual mesh AABB in BuildRenderList).
- [ ] procedural_mesh_factory: TODO caps/base cylinder/cone. Fix or doc.
- [ ] scene_manager: PrepareAnimationImportStub, PrepareSkinningImportStub. Doc “animation/skinning not in alpha”.
- [ ] engine.cpp: placeholder returns. Real logic or explicit “not implemented”.
- [ ] renderer.cpp / tiered_instance_manager: placeholder comments. Implement or remove.
- [ ] Config: all user-facing fields validated/clamped (config_loader.cpp). No unvalidated numeric input.
- [ ] Debug build + validation: no validation errors.
- [ ] Release build: smoke test; no crash, no silent failure.

================================================================================
7. GUIDELINES (docs/guidelines/coding-guidelines.md)
================================================================================

- [ ] Member naming: type prefix (m_sName, m_bInitialized, m_lWidth) where missing.
- [ ] No `!` in conditions: use (x == false), (ptr == nullptr). Grep and fix.
- [ ] Literals: explicit cast in definitions (static_cast<bool>(true), etc.). Grep = true, = 0, = nullptr, = 1.0f.
- [ ] Parameters: _ic / _out / _io on public API where missing.
- [ ] Include order: project first then std/lib; source: own header first.
- [ ] this-> for member access in classes.

================================================================================
8. DEAD / STUB / PLACEHOLDER CODE
================================================================================

- [x] core.h, managers.h: used as umbrella (main.cpp); managers.h includes all manager headers.
- [x] physics_component.h stub: documented "Not in alpha" in header (Section 2).
- [x] Editor placeholder menu items: red text + "Not implemented yet" tooltip (PlaceholderMenuItem).
- [ ] Large commented-out blocks: remove or #if 0 with short comment.
- [x] scene_unified: canonical; scene.h, scene_new.*, render_list_builder.* deleted from repo.

================================================================================
9. BUILD, INSTALL, RUN
================================================================================
(Use only project scripts: scripts/linux/build.sh, clean.sh, setup; scripts/windows/build.bat, clean.bat, etc.)

- [x] Clean + build (Debug): scripts/linux/clean.sh then scripts/linux/build.sh --debug — verified; fixed transform.h missing #include <cstdint> for scene_unified build.
- [ ] CMake: all sources/headers listed; no missing for current platform.
- [x] compile_shaders: produces .spv (build/shaders); install_local copies shaders, config, levels, models to install/Debug (verified in build).
- [x] README / getting-started: setup, build (Debug + Release), run with level path; docs/getting-started.md and README Quick Start aligned; script-only rule in README.
- [ ] Optional: run_alpha script (build + launch default level).

================================================================================
10. DOCS & CLIENT READINESS
================================================================================

- [x] README: “Alpha” + known limitations (animation/skinning, editor placeholders, physics/script stubs). Link to ROADMAP.
- [x] ROADMAP: already describes alpha scope vs post-alpha.
- [x] Version: set to 0.1.0 in CMake and README.
- [ ] Internal-only docs (future-ideas, placeholder platforms): mark or move so client doesn’t treat as delivered.
- [ ] Coding guidelines: single source of truth; link from README/CONTRIBUTING if needed.

================================================================================
11. CURSOR RULE & TESTS
================================================================================

- [ ] .cursor/rules/checkinstanc.mdc: matches “instance extensions checked before create”. Expand if needed.
- [x] No unit tests: README Alpha section + known limitations document “validate manually” for alpha. Optional: smoke script (run app, exit code 0).
- [ ] No assert()/abort() in Release hot path with valid input.

================================================================================
12. IMPROVEMENTS — DO WHILE REVIEWING
================================================================================
(Apply these as you fix/check; improves codebase without scope creep.)

- [ ] Single scene model: Migrate to SceneUnified only; remove scene.h and SceneNew.
- [x] Umbrella headers: main.cpp includes core/core.h and managers/managers.h.
- [ ] Deprecated API: remove old push-constant helpers from object.h once all call sites use instanced path; reduces confusion and maintenance.
- [ ] Config limits: move magic numbers (e.g. max objects, max lights) to named constants or config; easy to tune for scale.
- [ ] Descriptor layout: centralize binding numbers (e.g. enum or constants) so new pipelines/shaders don’t hardcode; reduces binding bugs.
- [ ] Error handling: consistent pattern (log + throw for fatal; return false + log for recoverable). No silent ignores.
- [ ] Include guards: prefer #pragma once everywhere; no mixed #ifndef.
- [ ] Forward decls: use in headers where possible; reduce compile time and coupling.
- [ ] Manager init order: document or enforce via a single InitManagers() that initializes in correct order; scales when adding new managers.
- [x] Editor menus: placeholders in red with "Not implemented yet" tooltip.

================================================================================
13. SCALABILITY — DESIGN FOR GROWTH
================================================================================
(Ensure architecture can grow without rewrites.)

- [ ] Object count: max objects from config; buffers/SSBOs sized from config. No hardcoded small limits in hot path.
- [ ] Light count: max lights (e.g. 256) and light buffer size configurable; shader loop/UBO size matches.
- [ ] Draw calls / batches: batching and sort order scale with more meshes; no O(n²) or per-draw alloc in inner loop.
- [ ] Scenes/levels: load/unload one scene at a time; clear refs so TrimUnused can run. No assumption of “single global scene” that can’t be swapped.
- [ ] Adding components: adding a new component type (e.g. Audio) follows docs: new pool, add to GameObject, one place to register. No hidden coupling.
- [ ] Adding managers: new manager registered in one place (e.g. VulkanApp + ResourceCleanupManager); init order documented.
- [ ] Adding shaders/pipelines: pipeline key + layout in one place; descriptor bindings from shared constants. New pass = new pipeline, no copy-paste of 20 bindings.
- [ ] Threading: job queue for load; resource thread for trim. No ad-hoc threads; adding new async work uses existing queue or documented pattern.
- [ ] Memory: large allocations (SSBOs, pools) driven by config or heuristics; no “fixed 1024” that blocks scaling.
- [ ] Platforms: platform-specific code behind interfaces or #if; adding new platform (e.g. mobile) doesn’t require touching core render path.
- [ ] Docs: architecture.md and ROADMAP describe how to add features; new dev can add component/manager/shader without guessing.

================================================================================
14. QUESTIONS FOR USER (ASK IF IN DOUBT)
================================================================================
(Unclear decisions — get your input before locking behavior.)

- Scene vs SceneUnified: for alpha and beyond, which is canonical? Remove the other or keep SceneUnified as “future” and document?
- Binding 8 (visible indices / GPU culler): ship alpha with culler on or off? Document and stub cleanly if off.
- Normals / emissive / material props (engine-design bugs): fix before alpha or list as known limitations?
- Version number: 0.1.0 / 0.9.0 / 1.0.0 for alpha build?
- Editor: which menu items must work for alpha demo vs “Coming later”? Disable the rest clearly.
- Scalability targets: any specific numbers (e.g. “must support 10k objects”, “50 lights”) to validate against?

================================================================================
15. QUICK REFERENCE — TODOs BY FILE
================================================================================

| Location                     | Action |
|-----------------------------|--------|
| scene_unified.*             | Remove as dead or integrate. |
| scene.h vs scene_unified.h   | Resolve dual “Scene” name; one source of truth. |
| object.h deprecated API     | Migrate or document. |
| vulkan_app SSBO binding 8   | Wire or stub; document. |
| scene_unified.cpp TODOs     | Hierarchy/bounds — implement or doc. |
| procedural_mesh cylinder/cone | Implement or doc. |
| scene_manager animation/skinning | Doc “not in alpha”. |
| engine.cpp placeholders     | Real logic or explicit nop. |
| Editor placeholder menus    | Red + tooltip (done). |
| core.h / managers.h         | Umbrella in main.cpp (done). |
| physics_component stub      | Doc or minimal behavior. |
| engine-design.md bugs       | Normals, emissive, material props — fix or doc. |

---
When every section is checked, improvements applied where listed, and scalability verified, the project is consistent, maintainable, and ready for client alpha demo.
When in doubt on a decision (e.g. Scene vs SceneUnified, culler on/off), ask the user before changing behavior.

--------------------------------------------------------------------------------
REVIEW LOG (updated as we go)
--------------------------------------------------------------------------------
- transform.h: added #include <cstdint> (build fix).
- User answers applied: SceneUnified keep+ROADMAP; umbrella (core.h, managers.h) in main.cpp; managers.h includes all manager headers; GPU culler always on; version 0.1.0; editor placeholders red+tooltip; scalability = Alpha test level; deprecated object.h: migrate then remove.
- main.cpp: include core/core.h and managers/managers.h (umbrella).
- managers.h: added includes for all manager headers (umbrella).
- ROADMAP: SceneUnified note "Kept in tree for future migration".
- README: v0.1.0; Alpha validation paragraph; editor placeholders described.
- CMakeLists.txt: VERSION 0.1.0.
- editor_layer.cpp: PlaceholderMenuItem tooltip "Not implemented yet".
- shaders/SHADER_LIST.md: current shaders, binding table, planned shaders, C++ todos.
- resource_manager_thread: handle TrimShaders and TrimAll in switch (callback was never run for TrimAll).
- vulkan_app: init list order (m_completedJobHandler before m_config); OnCompletedLoadJob handles LoadFile; removed unused constants (CONFIG_PATH_*, DEFAULT_LEVEL_PATH, LAYOUT_KEY_MAIN_FRAG_TEX).
- light_debug_renderer: go.transformIndex check with INVALID_COMPONENT_INDEX; switch handles Area and COUNT.
- main_menu: removed unused 'center' variable.
- batched_draw_list: removed unused MaxPushConstantSize.
- README: Alpha status, known limitations, install path and script-only rule.
- alpha_review/questions.txt: open decisions for user.
- Section 2 (Is everything used?): physics/script stubs documented "Not in alpha"; camera, RingBuffer, TieredInstanceManager, LevelSelector, StressTestGenerator confirmed used; object SSBO offset verified.
- Section 6: object.h kept for parsing/stress-test; scene_unified hierarchy and bounds implemented; scene.h/SceneNew removed from build.
- Cleanup: deleted scene.h, scene_new.h/cpp, render_list_builder.h/cpp. README Architecture: SceneNew → unified Scene.
